<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">   
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="HandheldFriendly" content="true">   
        <link href="./css/MicrosoftWord.css" rel="stylesheet">
        <link href="./css/Global.css" rel="stylesheet">
    </head>
    <body>
        <main> 
             <div id='top'>
                <div id='about'>
                    <img src="https://64.media.tumblr.com/482ba2e6e3136f986e765bb8dd8c5ffe/540d246794bf7091-d5/s540x810/6e1c994f78c1eb5006144767074ba2322b7fd318.png" alt='word icon'></img>
                    <p>About - Microsoft Word</p>
                </div>
                <div>
                    <button>_</button>
                    <button>O</button>
                    <button>X</button>
                </div> 
            </div>

             <div class='mocknav'>
                <div>
                    <div class="rectangle">i</div>
                    <p>File</p>
                    <p>Edit</p>
                    <p>View</p>
                    <p>Insert</p>
                    <p>Format</p>
                    <p>Tools</p>
                    <p>Table</p>
                    <p>Help</p>
                </div> 
                <button>x</button> 
            </div> 
             <div> 
                <div class='mocknav'>
                    <div class="rectangle">i</div>
                    <div>
                        <img id='img' src="http://i.imgur.com/6RErgJC.png"/>
                        <img id='img' src="./resources/sticker-png-windows-xp-folders-pack-256-folder-opened-256-icon-thumbnail-removebg-preview.png"/>
                        <img id='img' src="./resources/floppy-disk-removebg-preview.png"/> 
                        <img id='img' src="./resources/email-icon.drawio.png"/> 
                    </div> 
                    <div style="padding-left: 5px; border-left: 1px solid grey;">
                        <img id='img' src="./resources/printer-removebg-preview.png"/>
                        <img id='img' src="./resources/look-removebg-preview.png"/>
                        <img id='img' src="./resources/check-removebg-preview.png"/>
                    </div>
                    <div style="padding-left: 5px; border-left: 1px solid grey;">
                        <img id='img' src="./resources/scissors-removebg-preview.png"/>
                        <img id='img' src="./resources/papers-removebg-preview.png"/>
                        <img id='img' src="./resources/suitcase-removebg-preview.png"/>
                    </div>
                    <div style="padding-left: 5px; border-left: 1px solid grey;">
                        <img id='img' src="./resources/earth-removebg-preview.png"/>
                        <img id='img' src="./resources/calendar-removebg-preview.png"/> 
                    </div>
                    <div style="display: flex; justify-content: space-between; border-left: 1px solid grey; padding-left: 5px; align-items: center;">
                        <div>
                            <img id="img" style="height: 48px;" src="./resources/zoom.png"/>
                            <img id="img" src="./resources/question-removebg-preview.png"/>    
                        </div>
                        <img id="img" style="margin-left: 2rem" src="./resources/arrows-removebg-preview.png"/>
                    </div> 
                </div>
            </div> 
            <div> 
                <div class='mocknav'>
                    <div class="rectangle">i</div>
                    <div>
                        <img id="img" style="height: 8rem;" src="./resources/font-removebg-preview.png"/> 
                        <img id="img" style="height: 48px;" src="./resources/font-size-removebg-preview.png"/>
                    </div> 
                    <div>
                        <p>B</p>    
                        <p>I</p>
                        <p>U</p>
                    </div>
                    <div>
                        <img id='img' src="./resources/font-direction-left-removebg-preview.png"/>
                        <img id='img' src="./resources/font-direction-center-removebg-preview.png"/>
                    </div>
                    <div>
                        <img id='img' src="./resources/numbered-removebg-preview.png"/>
                        <img id='img' src="./resources/square-removebg-preview.png"/>
                        <img id='img' src="./resources/direction-left-removebg-preview.png"/>
                        <img id='img' src="./resources/direction-right-removebg-preview.png"/>
                    </div>

                    <div>
                        <img id='img' src="./resources/dash-square-removebg-preview.png"/>
                    </div>
                    <div class="arrows">
                        <img id="img" src="./resources/arrows-removebg-preview.png"/>
                    </div>
                </div>
            </div>

            <section>
                <h1>Monitoring Cloud Providers for cost analysis</h1>
                <p> Cloud efficiency is the ability to make the best use of your cloud environment, with the lowest cost and the least amount of waste. Unfortunately, it is not as easy as it sounds, and cloud inefficiencies are common — usually caused by the unpredictability of a cloud environment.</p>
                <p>Small cloud projects are easy to control and monitor, but as they expand and spread on multiple cloud platforms, they start to become inefficient from a financial point of view, which is quite common for reserved instances and savings plans, visibility and monitoring of cloud consumption, and wasted resources like idle or unused data.</p>
                <p>Developers do not have the time or the human resources available to keep an eye on consumption and trends around their usage while also completing their job, which is where Artificial intelligence can come in handy to make sure that they choose and use the appropriate resources.</p>
                <h2>Why should we use AI and ML for cost management?</h2>
                <p>By replacing more traditional ways of cost management, you can achieve more accurate forecasting, real-time monitoring, and automated optimization strategies. Using these technologies, you can go from reactive expense tracking to proactive, more intelligent, and thought-out financial management in the cloud.</p>
                <p>By automatically monitoring the resource usage and costs, you can find the issues faster, allowing you to optimize your multi-cloud environment at the right moment. For this project, we worked in a cloud environment with multiple cloud providers, and keeping track of the costs and resources became overwhelming and time-consuming, so we implemented AI and ML to ensure better resource allocation and timely anomaly detection.</p>
                <p>By implementing AI in our multi-cloud environment, we can process data in real-time and predict future trends, allowing us to have a more nuanced understanding and effective approach, making a significant difference in how someone could handle their cloud finances.</p>
                <h2>How can we use AI and ML for cost management?</h2>
                <p>We started by collecting the existing data to determine trends and patterns and choosing an appropriate forecasting model. By analyzing and visualizing the cost reports we obtained a clear view of how the cloud budget evolves to inform the user of possible problems within the cloud provider services.</p>
                <p>Continuously monitored cloud usage and expenses to help detect any possible irregularities using anomaly detection algorithms. Based on the patterns, AI can provide data-driven recommendations for cost optimization, such as identifying underutilized resources and providing instructions on how to fix them.</p>
                <h2>01 Collecting Data</h2>
                <p>For this project, it is essential to have a constant stream of new data getting to the project.</p>
                <p>For Amazon Web Services, the AWS Cost and Usage Report has to be enabled to access the cost reports. These reports can be customized, from what columns we want to include in the file to the timeframe we want. The reports are scheduled daily and stored in an Amazon S3.</p>
                <p>For GCP the data is collected using BigQuery from the Billing Exports section of Billing. The user needs the Billing Account Administrator and BigQuery User roles to start. After enabling the Cloud Billing export to BigQuery, Google automatically adds a service account as an owner to the dataset you specify.</p>
                <p>The data is selected from the cost reports with a query using the BigQuery studio. This query is part of a Python script that sends the information to a GCP storage bucket. The script is created in Cloud Function, along with the requirements.txt file.</p>
                <pre>
                    <code>
                        from google.cloud import bigquery
                        from google.cloud import storage
                        import os
                        def export_billing_data(request):
                        project = "project-name" 
                        dataset_id = "dataset_id"
                        table_id = "table_id" 
                        bucket_name = "bucket_name" 
                        destination_uri =
                        f"gs://{bucket_name}/destination_name.csv"
                        dataset_ref = bigquery.DatasetReference(project,
                        dataset_id)
                        table_ref = dataset_ref.table(table_id)
                        extract_job = client.extract_table(
                        table_ref,
                        destination_uri,
                        # Location must match that of the source table.
                        location="EU",
                        ) # API request
                        extract_job.result() # Waits for job to complete.
                        return f"Exported {project}:{dataset_id}.{table_id} to
                        {destination_uri}"
                    </code>
                </pre>
                <h2>02 Storing the data</h2>
                <p>After the reports are stored in the buckets from each cloud provider, we create a CI/CD pipeline that takes these reports and keeps them into a pipeline artifact. The artifact is pushed to the main branch to keep adding and updating the data and forecasts.</p>
                <pre>
                    <code>
                        deploy_aws:
                        tags:
                        - ff-acs-gitlab-runner
                        stage: deploy
                        image:
                        name: amazon/aws-cli
                        entrypoint: [""]
                        only:
                        - main
                        script:
                        - aws configure set aws_access_key_id
                        $AWS_ACCESS_KEY_ID
                        - aws configure set aws_secret_access_key
                        $AWS_SECRET_ACCESS_KEY
                        - aws s3 sync s3://bucket-name
                        ./resources
                        artifacts:
                        paths:
                        - resources/
                        deploy_gcp:
                        stage: deploy
                        image:
                        name: google/cloud-sdk
                        entrypoint: [""]
                        only:
                        - main
                        script:
                        - echo $GCP_SERVICE_KEY > /tmp/gcp-key.json
                        - gcloud auth activate-service-account --key-file
                        /tmp/gcp-key.json
                        - mkdir -p ./resources
                        - gsutil rsync -r gs://billing-ff2024/
                        ./resources
                        - rm /tmp/gcp-key.json
                        artifacts:
                        paths:
                        - resources/
                        push_reports:
                        stage: commit
                        tags:
                        - ff-acs-gitlab-runner
                        script:
                        - git config --global user.email
                        "email@gmail.com"
                        - git config --global user.name "User Name"
                        - git clone
                        https://oauth2:$ACCESS_TOKEN@gitlab.com/rest_of_url.git temp_repo
                        - cp -r resources/* temp_repo/
                        - cd temp_repo
                        - git add .
                        - git commit -m "Adding new cost reports"
                        - git push origin main
                        only:
                        - main
                        when: on_success
                    </code>
                </pre>
                <p>These CSV files are used to analyze the evolution of data over time and to gather enough data to get accurate forecasting.</p>
                <h2>Anomaly detection</h2>    
                <p>For anomaly detection, we chose a machine learning model called Isolation Forest. It is a model used to detect anomalies in data. It works by randomly splitting the data multiple times, isolating different points (anomalies) quickly, and requiring more splits to isolate normal points.</p>
                <p>The model measures how fast each point gets isolated: anomalies get isolated quickly (shorter path), while normal points take longer (longer path). Anomalies are identified based on their short path lengths in the isolation process. The values are split into two categories: anomaly (-1) and normal value (1).</p>
                <p>The values are saved in a CSV file and passed over to the API repository to implement the alarms for the user.</p>
                <h2>04 Forecasting</h2>
                <p>After collecting enough data, it is clear to see the patterns and trends in the evolution of the costs, so a time series model is the best for this data.</p>
                <p>We used the ARIMA model also known as an AutoRegressive Integrated Moving Average.</p>
                <p>The main feature of this model is that it can work even with non-stationary data by doing a differencing step one or more times to eliminate the non-stationarity.</p>
                <p>The autoregressive (AR) part of ARIMA indicates that the evolving variable of interest is regressed on its own lagged (i.e., prior) values.</p>
                <p>The moving average (MA) part indicates that the regression error is a linear combination of error terms whose values occurred contemporaneously and at various times in the past.</p>
                <p>The I (for “integrated”) indicates that the data values have been replaced with the difference between their value and the previous values.</p>
                <p>The model is part of the statsmodels Python module. It provides classes and functions for the estimations of many different statistical models and for conducting statistical tests or data exploration.</p>
                <p>The p, d, and q values are calculated to find the optimal values for the model for each service based on their cost values.</p>
                <ul>
                    <li>p: the number of lag observations in the model, also known as the lag order. It represents the number of days you want to look back to predict the data for the next day.</li>
                    <li>d: the number of times the raw observations are differenced; also known as the degree of differencing. It is used to see a clearer pattern in your data. You might look at the changes from one day to the next instead of the actual values.</li>
                    <li> q: the size of the moving average window, also known as the order of the moving average. It is like taking an average of past errors (differences between actual and predicted values) to smooth out your predictions. If q is 2, you’re using the average of the errors from the last two days to help make today’s prediction more accurate.</li>
                </ul>
                <p>The forecasting values are stored in individual CSV files to represent the forecasted values of each service on the dashboard.</p>
                <h2>05 User interface</h2>
                <p>For the user to access the forecasted values, we made a website using the framework Streamlit to plot and export the forecasting values for the next week.</p>
                <p>Streamlit is an open-source Python framework for data scientists and AI/ML engineers to deliver dynamic data apps with only a few lines of code. It enables developers to build attractive user interfaces in no time. Streamlit is the easiest way, especially for people with no front-end knowledge, to put their code into a web application: No front-end (HTML, JS, CSS) experience or knowledge is required.</p>
                <h2>06 Automation</h2>
                <p>The main idea of this project is to make the user’s work easier by not having to constantly check the cost reports or worry that they’re not using their resources accordingly.</p>
                <p>So, we made several CI/CD jobs to automate running the project. First, we used it to create a Docker image into the Container Registry to use it to deploy the forecast website and API on the internet. This docker image downloads the requirements and runs the main Python script.</p>
                <pre>
                    <code>
                        build:
                        tags:
                        - ff-acs-gitlab-runner
                        image:
                        name: gcr.io/kaniko-project/executor:v1.14.0-debug
                        entrypoint: [""]
                        stage: build
                        services:
                        - docker:dind
                        script:
                        - /kaniko/executor
                        --context "${CI_PROJECT_DIR}"
                        --dockerfile "${CI_PROJECT_DIR}/Dockerfile"
                        --destination
                        "${CI_REGISTRY_IMAGE}:${CI_COMMIT_TAG}"
                        --destination "${CI_REGISTRY_IMAGE}:latest"
                        rules:
                        - if: $CI_COMMIT_BRANCH
                        exists:
                        - Dockerfile
                    </code>
                </pre>
                <h2>07 Data-driven recomandations</h2>
                <p>Before, cost and multi-cloud management were two different projects with nothing in common. So, to fix this issue we created an API that is used on the cluster nodes to alert the user of overspending. The API will search for the possible cause of overspending and instruct the user on how to prevent it. To start, we imported the outlier and forecasted values and compared them. If the values surpass the threshold, an alert will pop up and let the user know what service might cause the overspending. The API is made using Flask.</p>
                <pre>
                    <code>
                        app = Flask(__name__)
                        @app.route('/', methods=['GET'])
                        def compare_values():
                        problem, answer = None, None
                        if any(amazon_cloud_watch_forecasts['forecast'] >
                        amazon_cloud_watch_threshold):
                        print("Overspending on Amazon CloudWatch")
                        results = check_amazoncloudwatch()
                        problem, answer = "Overspending on Amazon CloudWatch",
                        results
                        return jsonify({"problem": problem, "answer": answer})
                        if __name__ == '__main__':
                        app.run(debug=True)
                    </code>
                </pre>
                <p>The API knows what is causing the overspending problem by running multiple methods that check the state of the service. The methods are made based on the research done on overspending on each service.</p>
                <p>After the code finds what is wrong with the services, it initializes an OpenAI client and sends a prompt that asks how can the user fix the issue. The client’s answer is then displayed on the user interface. We used space and OpenAI gpt-3.5 to generate the answer to the prompt.</p>
                <pre>
                    <code>
                        client = OpenAI()
                        nlp = spacy.load("en_core_web_sm")
                        def get_nlp_response(prompt):
                        completion = client.chat.completions.create(
                        model="gpt-3.5-turbo",
                        messages=[{"role": "user", "content": prompt}]
                        )
                        return completion.choices[0].message.content
                    </code>
                </pre>
                <p>After completing the analysis, the answers are transferred to a Stremlit application to make the instructions more readable for the user. Now, the user can go and try to fix the overspending issue.</p>
                <p>** Check the full code on GitHub: <a href="https://github.com/alexiacismaru/cost-monitoring-using-python">https://github.com/alexiacismaru/cost-monitoring-using-python</a> </p>
            </section>

            <div> 
                <div class='mocknav'>
                    <div class="rectangle">i</div>
                    <div>
                        <p>Draw &#9662;</p>
                        <img id="img" src="./resources/cursor-removebg-preview.png"/>
                        <img id="img"src="./resources/reload-removebg-preview.png"/>
                    </div> 
                    <div>
                        <p>AutoShapes &#9662;</p>
                        <div class="shape"></div>
                        <img id="img"src="./resources/arrow-removebg-preview.png"/>
                        <div class="square"></div>
                        <div class="circle"></div>
                        <img id="img"src="./resources/text-removebg-preview.png"/>
                        <img id="img"src="./resources/letters-removebg-preview.png"/>
                        <img id="img"src="./resources/clown-removebg-preview.png"/>
                    </div>
                    <div>
                        <img id="img"src="./resources/paint-bucket-removebg-preview.png"/>
                        <img id="img"src="./resources/brush-removebg-preview.png"/>
                        <img id="img"src="./resources/letter-removebg-preview.png"/>
                    </div>
                    <div class="arrows">
                        <img id="img" src="./resources/arrows-removebg-preview.png"/>
                    </div>
                </div>
            </div>
            <div style="background-color: #e3dac9;"> 
                <div id='bottom'>
                    <div style="width: 25rem;">
                        <p>Page 1</p>
                        <p>Sec 1</p>
                        <p>1/1</p>
                    </div> 
                    <div style="width: 50%;">
                        <p>At 1"</p>    
                        <p>Ln 1</p>
                        <p>Col 1</p>
                    </div>
                    <div style="color: grey; width: 15%;">
                        <p>REC</p>
                    </div>
                    <div style="color: grey; width: 15%;">
                        <p>TRK</p>
                    </div> 
                    <div style="color: grey; width: 15%;">
                        <p>EXT</p>
                    </div>
                </div>
            </div>
        </main>
    </body>
</html>