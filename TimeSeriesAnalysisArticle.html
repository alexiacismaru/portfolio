<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">   
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="HandheldFriendly" content="true">   
        <link href="./css/MicrosoftWord.css" rel="stylesheet">
        <link href="./css/Global.css" rel="stylesheet">
    </head>
    <body>
        <main> 
             <div id='top'>
                <div id='about'>
                    <img src="https://64.media.tumblr.com/482ba2e6e3136f986e765bb8dd8c5ffe/540d246794bf7091-d5/s540x810/6e1c994f78c1eb5006144767074ba2322b7fd318.png" alt='word icon'></img>
                    <p>About - Microsoft Word</p>
                </div>
                <div>
                    <button>_</button>
                    <button>O</button>
                    <button>X</button>
                </div> 
            </div>

             <div class='mocknav'>
                <div>
                    <div class="rectangle">i</div>
                    <p>File</p>
                    <p>Edit</p>
                    <p>View</p>
                    <p>Insert</p>
                    <p>Format</p>
                    <p>Tools</p>
                    <p>Table</p>
                    <p>Help</p>
                </div> 
                <button>x</button> 
            </div> 
             <div> 
                <div class='mocknav'>
                    <div class="rectangle">i</div>
                    <div>
                        <img id='img' src="http://i.imgur.com/6RErgJC.png"/>
                        <img id='img' src="./resources/sticker-png-windows-xp-folders-pack-256-folder-opened-256-icon-thumbnail-removebg-preview.png"/>
                        <img id='img' src="./resources/floppy-disk-removebg-preview.png"/> 
                        <img id='img' src="./resources/email-icon.drawio.png"/> 
                    </div> 
                    <div style="padding-left: 5px; border-left: 1px solid grey;">
                        <img id='img' src="./resources/printer-removebg-preview.png"/>
                        <img id='img' src="./resources/look-removebg-preview.png"/>
                        <img id='img' src="./resources/check-removebg-preview.png"/>
                    </div>
                    <div style="padding-left: 5px; border-left: 1px solid grey;">
                        <img id='img' src="./resources/scissors-removebg-preview.png"/>
                        <img id='img' src="./resources/papers-removebg-preview.png"/>
                        <img id='img' src="./resources/suitcase-removebg-preview.png"/>
                    </div>
                    <div style="padding-left: 5px; border-left: 1px solid grey;">
                        <img id='img' src="./resources/earth-removebg-preview.png"/>
                        <img id='img' src="./resources/calendar-removebg-preview.png"/> 
                    </div>
                    <div style="display: flex; justify-content: space-between; border-left: 1px solid grey; padding-left: 5px; align-items: center;">
                        <div>
                            <img id="img" style="height: 48px;" src="./resources/zoom.png"/>
                            <img id="img" src="./resources/question-removebg-preview.png"/>    
                        </div>
                        <img id="img" style="margin-left: 2rem" src="./resources/arrows-removebg-preview.png"/>
                    </div> 
                </div>
            </div> 
            <div> 
                <div class='mocknav'>
                    <div class="rectangle">i</div>
                    <div>
                        <img id="img" style="height: 8rem;" src="./resources/font-removebg-preview.png"/> 
                        <img id="img" style="height: 48px;" src="./resources/font-size-removebg-preview.png"/>
                    </div> 
                    <div>
                        <p>B</p>    
                        <p>I</p>
                        <p>U</p>
                    </div>
                    <div>
                        <img id='img' src="./resources/font-direction-left-removebg-preview.png"/>
                        <img id='img' src="./resources/font-direction-center-removebg-preview.png"/>
                    </div>
                    <div>
                        <img id='img' src="./resources/numbered-removebg-preview.png"/>
                        <img id='img' src="./resources/square-removebg-preview.png"/>
                        <img id='img' src="./resources/direction-left-removebg-preview.png"/>
                        <img id='img' src="./resources/direction-right-removebg-preview.png"/>
                    </div>

                    <div>
                        <img id='img' src="./resources/dash-square-removebg-preview.png"/>
                    </div>
                    <div class="arrows">
                        <img id="img" src="./resources/arrows-removebg-preview.png"/>
                    </div>
                </div>
            </div>

            <section> 
                <h1>Predicting pollution using a Time-Series Analysis model</h1>
                <img src="./resources/timeseriesanalysis/screeenshot1.jpg"/>
                <p>How to predict time-sensitive data using SARIMAX.</p>
                <p>Pollution is one of the most relevant environmental challenges of the modern age, affecting millions daily. With urbanization and industrial growth, air quality has significantly deteriorated. Accurate prediction of pollution levels is critical to assessing pollution levels in your city or country correctly. One powerful tool for forecasting pollution levels is the SARIMAX model, a time series forecasting technique capable of handling seasonal patterns that take into consideration external factors that can affect the predicted values.</p>
                <p>In this article, we explore the SARIMAX model and how it can be effectively used to predict pollution levels.</p>
                <h2>What is a SARIMAX model?</h2>
                <p>SARIMAX stands for <b>Seasonal AutoRegressive Integrated Moving Average with eXogenous variables.</b> It is an extension of the ARIMA model (AutoRegressive Integrated Moving Average) that accounts for seasonality and incorporates external factors (exogenous variables) that might influence the forecast.</p>
                <h3>ARIMA model</h3>
                <p>To better understand the SARIMAX model, here is a breakdown of the basic ARIMA model. This is a powerful tool specifically used for forecasting time-dependent variables. It has three main components:</p>
                <ul>
                    <li><b>AutoRegression (AR):</b> this takes into account the past values to predict the current ones. In code, this is represented by the letter <i>p</i>. Performs linear regression on the past p values on the time series to forecast the current values.</li>
                </ul>
                <img style="height: 5rem;" src="./resources/timeseriesanalysis/screeenshot2.jpg"/>
                <ul>
                    <li><b>Moving Average (MA):</b> takes care of past errors in predictions. In Python, this is noted with the letter <i>q</i>. Performs linear regression on the last q error values to predict the correct value.</li>
                </ul>
                <img style="height: 5rem;" src="./resources/timeseriesanalysis/screeenshot3.jpg"/>
                <ul>
                    <li><b>Integration (I):</b> makes the times series stationary. This means that the moving average is consistent throughout the existing values.</li>
                </ul>
                <p>** If the data is not stationary from the beginning, this can be made stationary after some differentiations. The ARIMA model is then characterized by three coefficients: its autoregression order <i>p</i>, and integration order <i>d</i>, corresponding to the number of differentiations required to make the time series stationary. If the series is stationary, d would be zero. And lastly, its moving-average order <i>q</i>.</p>
                <h3>SARIMAX model</h3>
                <p>Two components differentiate the SARIMAX model from the original ARIMA: seasonal patterns and exogenous variables.</p>
                <p>A <b>seasonal pattern</b> occurs when a variable is affected by seasonal factors like the year or the time of the week. Seasonality is always of a fixed an known frequency.</p>
                <img src="./resources/timeseriesanalysis/screeenshot4.jpg"/>
                <p><b>Exogenous variables</b> are variables whose cause is external to the model and whose role is to explain other variables or outcomes in the model.</p>
                <h2>Using SARIMAX to forecast pollution values in a Python project</h2>
                <p>** Before implementing the model make sure that the data is clean, has no duplicates, and most importantly has a clear time stamp for each row.</p>
                <h3>Explore the data</h3>
                <p>Start with some descriptive statistics to summarize the features of the data frame.</p>
                <pre>
                    <code>
                        data = pd.read_csv('clean-data.csv')

                        statistics = data.drop(columns=['id', 'timestamp']).describe() # the 'id' and 'timestamp' columns can't represent statitstics
                        round(statistics, 2) 
                    </code>
                </pre>
                <p>Perform a correlation analysis between the target variable and the other variables to identify significant relationships.</p>
                <p>A positive correlation is a relationship between two variables that tend to move in the same direction. A positive correlation exists when one variable tends to decrease as the other variable decreases, or one variable tends to increase when the other increases.</p>
                <p>A negative, or inverse correlation, between two variables indicates that one variable increases while the other decreases, and vice-versa.</p>
                <pre>
                    <code>
                        correlations = {}
                        correlation_df = data.drop(columns=['id','timestamp', 'latitude', 'longitude']) 

                        for column in correlation_df.columns:
                            if column != 'pollution':
                                corr, _ = pearsonr(correlation_df['pollution'], correlation_df[column])
                                correlations[column] = corr

                        sns.heatmap(correlation_df.corr(), annot=True, cmap='coolwarm')
                        plt.title('Correlation Matrix')
                        plt.show()
                    </code>
                </pre>
                <img src="./resources/timeseriesanalysis/screeenshot5.jpg"/>
                <p>Based on these results, the most influential variables for predicting pollution are the pressure and wind speed.</p>
                <p>Check the evolution of the target and the exogenous variables over time to check for seasonality.</p>
                <pre>
                    <code>
                        data["pollution"].plot(figsize=(16, 6), fontsize=5)
                        plt.xlabel("Date")
                        plt.ylabel("Pollution")


                        data["traffic_level"].plot(figsize=(16, 6), fontsize=5)
                        plt.xlabel("Date")
                        plt.ylabel("Traffic Level")


                        data["wind_speed"].plot(figsize=(16, 6), fontsize=5)
                        plt.xlabel("Date")
                        plt.ylabel("Wind Speed")
                    </code>
                </pre>
                <img src="./resources/timeseriesanalysis/screeenshot6.jpg"/>
                <p>Plot the seasonal decomposition of the target variable.</p>
                <pre>
                    <code>
                        results = seasonal_decompose(data['pollution'], period=720) # One month period
                        results.plot()
                    </code>
                </pre>
                <ul>
                    <li>The <i>trend component</i> helps us see the evolution of data over time: if it’s increasing, decreasing, or consistent over the days.</li>
                    <li>The <i>seasonal component</i> helps pick up any patterns in the data.</li>
                    <li>The <i>residual component</i> represents any unusual or unexpected values within the data.</li>
                </ul>
                <img src="./resources/timeseriesanalysis/screeenshot7.jpg"/>
                <p>Now, you can move on to the forecasting part of the project.</p>
                <p>Import the data and set the timestamp as the index.</p>
                <pre>
                    <code>
                        data = pd.read_csv('clean-data.csv')

                        data.set_index('timestamp', inplace=True)
                        data.sort_index(inplace=True)
                    </code>
                </pre>
                <p>Make sure that you have enough data for your predictions. For example you want to predict the next 48 hours, you need at least 48 entries in the data frame.</p>
                <pre>
                    <code>
                        print(f"Number of rows in DataFrame: {len(df)}")
                    </code>
                </pre>
                <p>Check for stationarity. Stationarity is an important characteristic of time series data. A stationary time series is one whose statistical properties like mean, variance, autocorrelation, etc., are all constant over time. This means that the mean and variance of the series should not be a function of time. If the series is stationary, it is easier to model its behavior.</p>
                <pre>
                    <code>
                        def adfuller_test(pollution):
                            result = adfuller(pollution) 
                            if result[1] <= 0.05:
                                print('strong evidence against the null hypothesis(Ho), reject the null hypothesis, data is stationary')
                            else:
                                print('weak evidence against the null hypothesis(Ho), data is not stationary')

                        adfuller_test(data['pollution'])
                    </code>
                </pre>
                <p>Calculate the <i>p, d, and q</i> values.</p>
                <ul>
                    <li><i>p</i>: the number of lag observations in the model, also known as the lag order. It represents the number of days you want to look back to predict the data for the next day.</li>
                    <li><i>d</i>: the number of times the raw observations are differenced; also known as the degree of differencing. It is used to see a clearer pattern in your data. You might look at the changes from one day to the next instead of the actual values.</li>
                    <li><i>q</i>: the size of the moving average window, also known as the order of the moving average. It is like taking an average of past errors (differences between actual and predicted values) to smooth out your predictions. If q is 2, you’re using the average of the errors from the last two days to help make today’s prediction more accurate.</li>
                </ul>   
                <pre>
                    <code>
                        stepwise_fit = auto_arima(data['pollution'], trace=True)
                    </code>
                </pre>
                <p>Train and predict the model.</p>
                <pre>
                    <code>
                        ######### Split the data into training and validation sets #########
                        split_index = int(0.70 * len(df))
                        train_exog = df[['traffic_level', 'pressure']][:split_index]
                        train_endog = df['pollution'][:split_index]
                        exog = df[['traffic_level', 'pressure']]  

                        ######### Train the model for each dataframe #########
                        model = sm.tsa.statespace.SARIMAX(df['pollution'], order=(0, 1, 1), seasonal_order=(0, 1, 1, 48))
                        results = model.fit()

                        ######## Forecasting #########
                        forecast_exog = exog[-48:]  # Use the last 48 hours of exogenous variables 
                        forecast = results.forecast(steps=12, exog=forecast_exog)
                    </code>
                </pre>
                <p>In conclusion, you should choose the SARIMAX model if:</p>
                <ul>
                    <li>The data is a times series.</li>
                    <li>The dataset contains external factors that can influence the target variable.</li>
                    <li>You need a flexible model that can handle complex data relationships, including non-stationary data, which is common in real-world time series like pollution data.</li>
                </ul>
            </section>

            <div> 
                <div class='mocknav'>
                    <div class="rectangle">i</div>
                    <div>
                        <p>Draw &#9662;</p>
                        <img id="img" src="./resources/cursor-removebg-preview.png"/>
                        <img id="img"src="./resources/reload-removebg-preview.png"/>
                    </div> 
                    <div>
                        <p>AutoShapes &#9662;</p>
                        <div class="shape"></div>
                        <img id="img"src="./resources/arrow-removebg-preview.png"/>
                        <div class="square"></div>
                        <div class="circle"></div>
                        <img id="img"src="./resources/text-removebg-preview.png"/>
                        <img id="img"src="./resources/letters-removebg-preview.png"/>
                        <img id="img"src="./resources/clown-removebg-preview.png"/>
                    </div>
                    <div>
                        <img id="img"src="./resources/paint-bucket-removebg-preview.png"/>
                        <img id="img"src="./resources/brush-removebg-preview.png"/>
                        <img id="img"src="./resources/letter-removebg-preview.png"/>
                    </div>
                    <div class="arrows">
                        <img id="img" src="./resources/arrows-removebg-preview.png"/>
                    </div>
                </div>
            </div>
            <div style="background-color: #e3dac9;"> 
                <div id='bottom'>
                    <div style="width: 25rem;">
                        <p>Page 1</p>
                        <p>Sec 1</p>
                        <p>1/1</p>
                    </div> 
                    <div style="width: 50%;">
                        <p>At 1"</p>    
                        <p>Ln 1</p>
                        <p>Col 1</p>
                    </div>
                    <div style="color: grey; width: 15%;">
                        <p>REC</p>
                    </div>
                    <div style="color: grey; width: 15%;">
                        <p>TRK</p>
                    </div> 
                    <div style="color: grey; width: 15%;">
                        <p>EXT</p>
                    </div>
                </div>
            </div>
        </main>
    </body>
</html>